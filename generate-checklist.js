// ================================
// å®Ÿåœ°æŒ‡å°ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆAI
// generate-checklist.js
// ================================

const ANSWER_LABEL = {
  yes: "ã¯ã„",
  no: "ã„ã„ãˆ",
  unknown: "ã‚ã‹ã‚‰ãªã„"
};

window.CHECKLIST_QUESTIONS = [
  {
    section: "ç¬¬27æ¡ã®2ï¼ˆè™å¾…é˜²æ­¢ï¼‰",
    critical: true,

    judgment: {
      red: {
        threshold: 2,
        summary: "è™å¾…é˜²æ­¢ã¯å®Ÿåœ°æŒ‡å°ã§æœ€ã‚‚é‡ç‚¹çš„ã«ç¢ºèªã•ã‚Œã¾ã™ã€‚æœªæ•´å‚™é …ç›®ã¯å¿…ãšäº‹å‰ã«æ˜¯æ­£ã—ã¦ãã ã•ã„ã€‚"
      },
      yellow: {
        threshold: 1,
        summary: "è™å¾…é˜²æ­¢ä½“åˆ¶ã«ä¸€éƒ¨ç¢ºèªä¸è¶³ãŒã‚ã‚Šã¾ã™ã€‚æŒ‡é‡ãƒ»ç ”ä¿®ãƒ»å§”å“¡ä¼šã®è¨˜éŒ²ã‚’æ•´ç†ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚"
      },
      green: {
        summary: "è™å¾…é˜²æ­¢ä½“åˆ¶ã¯æ¦‚ã­æ•´å‚™ã•ã‚Œã¦ã„ã¾ã™ã€‚"
      }
    },

    questions: [
      {
        id: "abuse_policy",
        text: "è™å¾…é˜²æ­¢ã®ãŸã‚ã®æŒ‡é‡ã‚’æ–‡æ›¸ã§æ•´å‚™ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ",
        feedback: {
          yes: "ğŸŸ¢ æŒ‡é‡ãŒæ•´å‚™ã•ã‚Œã¦ã„ã‚Œã°æ¦‚ã­å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚æœ€çµ‚æ”¹è¨‚æ—¥ã¨äº‹æ¥­æ‰€åã®è¨˜è¼‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
          no: "ğŸ”´ æŒ‡é‡ã®æœªæ•´å‚™ã¯é‡å¤§ãªæŒ‡æ‘˜ã«ã¤ãªãŒã‚Šã¾ã™ã€‚äº‹æ¥­æ‰€åãƒ»è²¬ä»»è€…ãƒ»å¯¾å¿œæ‰‹é †ã‚’æ˜è¨˜ã—ãŸæ–‡æ›¸ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚",
          unknown: "ğŸŸ¡ æŒ‡é‡ã®æœ‰ç„¡ã‚’è‡³æ€¥ç¢ºèªã—ã¦ãã ã•ã„ã€‚å®Ÿåœ°æŒ‡å°ã§ã¯å³æ™‚æç¤ºã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚"
        },
        documents: [
          "è™å¾…é˜²æ­¢ã®ãŸã‚ã®æŒ‡é‡",
          "æœ€çµ‚æ”¹è¨‚æ—¥ãŒåˆ†ã‹ã‚‹è¨˜éŒ²"
        ]
      },
      {
        id: "abuse_training",
        text: "è™å¾…é˜²æ­¢ã«é–¢ã™ã‚‹ç ”ä¿®ã‚’å®šæœŸçš„ã«å®Ÿæ–½ã—ã€è¨˜éŒ²ã‚’æ®‹ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ",
        feedback: {
          yes: "ğŸŸ¢ ç ”ä¿®å®Ÿæ–½ã¨è¨˜éŒ²ãŒç¢ºèªã§ãã‚Œã°å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚",
          no: "ğŸ”´ ç ”ä¿®æœªå®Ÿæ–½ãƒ»è¨˜éŒ²ãªã—ã¯é«˜ç¢ºç‡ã§æŒ‡æ‘˜ã•ã‚Œã¾ã™ã€‚æ—¥æ™‚ãƒ»å‚åŠ è€…ãƒ»å†…å®¹ã‚’è¨˜éŒ²ã—ã¦ãã ã•ã„ã€‚",
          unknown: "ğŸŸ¡ ç ”ä¿®è¨˜éŒ²ã®æœ‰ç„¡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚å£é ­å®Ÿæ–½ã®ã¿ã§ã¯ä¸ååˆ†ã§ã™ã€‚"
        },
        documents: [
          "è™å¾…é˜²æ­¢ç ”ä¿®ã®å®Ÿæ–½è¨˜éŒ²",
          "ç ”ä¿®è³‡æ–™"
        ]
      },
      {
        id: "abuse_committee",
        text: "è™å¾…é˜²æ­¢ã®ãŸã‚ã®å§”å“¡ä¼šã‚’è¨­ç½®ã—ã€å®šæœŸçš„ã«é–‹å‚¬ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ",
        feedback: {
          yes: "ğŸŸ¢ å§”å“¡ä¼šã®è¨­ç½®ãƒ»é–‹å‚¬å®Ÿç¸¾ãŒç¢ºèªã§ãã‚Œã°æ¦‚ã­è‰¯å¥½ã§ã™ã€‚",
          no: "ğŸ”´ å§”å“¡ä¼šæœªè¨­ç½®ãƒ»æœªé–‹å‚¬ã¯é‡ç‚¹æŒ‡æ‘˜äº‹é …ã§ã™ã€‚è­°äº‹éŒ²ã‚’æ•´å‚™ã—ã¦ãã ã•ã„ã€‚",
          unknown: "ğŸŸ¡ å§”å“¡ä¼šã®é–‹å‚¬çŠ¶æ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚åç§°ãŒç•°ãªã£ã¦ã‚‚è¨˜éŒ²ãŒå¿…è¦ã§ã™ã€‚"
        },
        documents: [
          "è™å¾…é˜²æ­¢å§”å“¡ä¼šã®è­°äº‹éŒ²"
        ]
      },
      {
        id: "abuse_manager",
        text: "è™å¾…é˜²æ­¢ã®æ‹…å½“è€…ã‚’å®šã‚ã€å½¹å‰²ã‚’æ˜ç¢ºã«ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ",
        feedback: {
          yes: "ğŸŸ¢ æ‹…å½“è€…ãŒæ˜ç¢ºã§ã‚ã‚Œã°å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚",
          no: "ğŸ”´ æ‹…å½“è€…æœªè¨­å®šã¯æŒ‡æ‘˜å¯¾è±¡ã§ã™ã€‚æ–‡æ›¸ã§æ˜ç¢ºã«ã—ã¦ãã ã•ã„ã€‚",
          unknown: "ğŸŸ¡ æŒ‡é‡ã‚„é‹å–¶è¦ç¨‹å†…ã®è¨˜è¼‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
        },
        documents: [
          "è™å¾…é˜²æ­¢æ‹…å½“è€…ã®é¸ä»»è¨˜éŒ²"
        ]
      }
    ]
  },

  {
    section: "ç¬¬4æ¡ï¼ˆå†…å®¹åŠã³æ‰‹ç¶šã®èª¬æ˜ãƒ»åŒæ„ï¼‰",
    critical: false,

    judgment: {
      red: {
        threshold: 2,
        summary: "é‡è¦äº‹é …èª¬æ˜ã‚„åŒæ„ã«ä¸å‚™ãŒã‚ã‚‹å ´åˆã€å®Ÿåœ°æŒ‡å°ã§å¿…ãšæŒ‡æ‘˜ã•ã‚Œã¾ã™ã€‚ç½²åãƒ»èª¬æ˜è¨˜éŒ²ã‚’é‡ç‚¹çš„ã«ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
      },
      yellow: {
        threshold: 1,
        summary: "èª¬æ˜ãƒ»åŒæ„ã®è¨˜éŒ²ã«ä¸€éƒ¨ä¸å®‰ãŒã‚ã‚Šã¾ã™ã€‚å¥‘ç´„æ™‚æ›¸é¡ã®æ•´åˆæ€§ã‚’ç¢ºèªã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚"
      },
      green: {
        summary: "é‡è¦äº‹é …èª¬æ˜ãŠã‚ˆã³åŒæ„ã¯é©åˆ‡ã«è¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚"
      }
    },

    questions: [
      {
        id: "04_policy",
        text: "é‡è¦äº‹é …èª¬æ˜æ›¸ã‚’äº¤ä»˜ã—ã€åˆ©ç”¨è€…ã¾ãŸã¯å®¶æ—ã¸èª¬æ˜ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ",
        feedback: {
          yes: "ğŸŸ¢ èª¬æ˜ãƒ»äº¤ä»˜ãŒç¢ºèªã§ãã‚Œã°å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚",
          no: "ğŸ”´ èª¬æ˜ãƒ»äº¤ä»˜ãªã—ã¯æŒ‡æ‘˜å¯¾è±¡ã§ã™ã€‚åˆå›å¥‘ç´„æ™‚ã®å¯¾å¿œã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚",
          unknown: "ğŸŸ¡ èª¬æ˜æ›¸ã®æ§ãˆã‚„ç½²åã®æœ‰ç„¡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
        },
        documents: ["é‡è¦äº‹é …èª¬æ˜æ›¸ï¼ˆç½²åä»˜ãï¼‰"]
      },
      {
        id: "04_consent",
        text: "èª¬æ˜å†…å®¹ã«ã¤ã„ã¦ã€æ–‡æ›¸ã§åŒæ„ã‚’å¾—ã¦ã„ã¾ã™ã‹ï¼Ÿ",
        feedback: {
          yes: "ğŸŸ¢ æ–‡æ›¸åŒæ„ãŒã‚ã‚Œã°å®‰å¿ƒã§ã™ã€‚",
          no: "ğŸ”´ å£é ­åŒæ„ã®ã¿ã¯ä¸ååˆ†ã§ã™ã€‚ç½²åæ¬„ã‚’è¨­ã‘ã¦ãã ã•ã„ã€‚",
          unknown: "ğŸŸ¡ å¥‘ç´„æ›¸ãƒ»åŒæ„æ›¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
        },
        documents: ["åˆ©ç”¨å¥‘ç´„æ›¸", "åŒæ„æ›¸"]
      }
    ]
  },

  {
    section: "ç¬¬13æ¡ï¼ˆæŒ‡å®šå±…å®…ä»‹è­·æ”¯æ´ã®å…·ä½“çš„å–æ‰±æ–¹é‡ï¼‰",
    critical: false,

    judgment: {
      red: {
        threshold: 2,
        summary: "ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã‚„ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã®æœªå®Ÿæ–½ãƒ»æœªè¨˜éŒ²ã¯é‡ç‚¹æŒ‡æ‘˜äº‹é …ã§ã™ã€‚å®Ÿå‹™è¨˜éŒ²ã‚’æ—©æ€¥ã«è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚"
      },
      yellow: {
        threshold: 1,
        summary: "æ”¯æ´çµŒéã‚„ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã®è¨˜éŒ²ã«ä¸€éƒ¨ä¸è¶³ãŒã‚ã‚Šã¾ã™ã€‚è¨˜éŒ²å†…å®¹ã‚’æ•´ç†ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚"
      },
      green: {
        summary: "å±…å®…ä»‹è­·æ”¯æ´ã®å®Ÿå‹™ã¯é©åˆ‡ã«è¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚"
      }
    },

    questions: [
      {
        id: "13_assessment",
        text: "åˆ©ç”¨è€…å®…ã‚’è¨ªå•ã—ã€é¢æ¥ã«ã‚ˆã‚‹ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã‚’è¡Œã£ã¦ã„ã¾ã™ã‹ï¼Ÿ",
        feedback: {
          yes: "ğŸŸ¢ è¨ªå•ãƒ»é¢æ¥è¨˜éŒ²ãŒã‚ã‚Œã°å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚",
          no: "ğŸ”´ è¨ªå•ãªã—ã®ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã¯æŒ‡æ‘˜ã•ã‚Œã‚„ã™ã„ç‚¹ã§ã™ã€‚",
          unknown: "ğŸŸ¡ æ”¯æ´çµŒéè¨˜éŒ²ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
        },
        documents: ["ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆè¨˜éŒ²"]
      },
      {
        id: "13_monitoring",
        text: "æœˆ1å›ä»¥ä¸Šã®ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã„ã€è¨˜éŒ²ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ",
        feedback: {
          yes: "ğŸŸ¢ å®šæœŸçš„ãªè¨˜éŒ²ãŒã‚ã‚Œã°å®‰å¿ƒã§ã™ã€‚",
          no: "ğŸ”´ æœªå®Ÿæ–½ãƒ»æœªè¨˜éŒ²ã¯é‡ç‚¹æŒ‡æ‘˜äº‹é …ã§ã™ã€‚",
          unknown: "ğŸŸ¡ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è¨˜éŒ²ã®æœ‰ç„¡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
        },
        documents: ["ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è¨˜éŒ²"]
      }
    ]
  },

  {
    section: "ç¬¬18æ¡ï¼ˆé‹å–¶è¦ç¨‹ï¼‰",
    critical: false,

    judgment: {
      red: {
        threshold: 2,
        summary: "é‹å–¶è¦ç¨‹ã®æœªæ•´å‚™ã‚„å†…å®¹ä¸ä¸€è‡´ã¯å¿…ãšæŒ‡æ‘˜ã•ã‚Œã¾ã™ã€‚æ—©æ€¥ã«ç¾çŠ¶ã«åˆã‚ã›ã¦ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚"
      },
      yellow: {
        threshold: 1,
        summary: "é‹å–¶è¦ç¨‹ã®æ›´æ–°çŠ¶æ³ã«ä¸€éƒ¨ä¸å®‰ãŒã‚ã‚Šã¾ã™ã€‚æœ€çµ‚æ”¹è¨‚æ—¥ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
      },
      green: {
        summary: "é‹å–¶è¦ç¨‹ã¯ç¾è¡Œä½“åˆ¶ã«æ²¿ã£ã¦æ•´å‚™ã•ã‚Œã¦ã„ã¾ã™ã€‚"
      }
    },

    questions: [
      {
        id: "18_exists",
        text: "é‹å–¶è¦ç¨‹ã‚’æ•´å‚™ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ",
        feedback: {
          yes: "ğŸŸ¢ é‹å–¶è¦ç¨‹ãŒæ•´å‚™ã•ã‚Œã¦ã„ã‚Œã°å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚",
          no: "ğŸ”´ æœªæ•´å‚™ã¯å¿…ãšæŒ‡æ‘˜ã•ã‚Œã¾ã™ã€‚æ—©æ€¥ã«ä½œæˆã—ã¦ãã ã•ã„ã€‚",
          unknown: "ğŸŸ¡ ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ‰ç„¡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
        },
        documents: ["é‹å–¶è¦ç¨‹"]
      },
      {
        id: "18_update",
        text: "é‹å–¶è¦ç¨‹ã¯æœ€æ–°ã®æ³•ä»¤ãƒ»ä½“åˆ¶ã«åˆã£ã¦ã„ã¾ã™ã‹ï¼Ÿ",
        feedback: {
          yes: "ğŸŸ¢ æ›´æ–°æ—¥ãŒæ–°ã—ã‘ã‚Œã°å®‰å¿ƒã§ã™ã€‚",
          no: "ğŸ”´ å¤ã„å†…å®¹ã®ã¾ã¾ã§ã¯æŒ‡æ‘˜ã•ã‚Œã‚„ã™ã„ã§ã™ã€‚",
          unknown: "ğŸŸ¡ æœ€çµ‚æ”¹è¨‚æ—¥ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
        },
        documents: ["é‹å–¶è¦ç¨‹ï¼ˆæ”¹è¨‚å±¥æ­´ï¼‰"]
      }
    ]
  },

  {
    section: "ãã®ä»–ã®ç¢ºèªäº‹é …ï¼ˆå½¢å¼ãƒ»ä½“åˆ¶ï¼‰",
    level: "C",
    bulk: true,
    critical: false,

    judgment: {
      red: {
        threshold: 3,
        summary: "è¤‡æ•°ã®å½¢å¼çš„è¦ä»¶ã«æœªç¢ºèªäº‹é …ãŒã‚ã‚Šã¾ã™ã€‚å®Ÿåœ°æŒ‡å°ã§ã¯ã¾ã¨ã‚ã¦æŒ‡æ‘˜ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚"
      },
      yellow: {
        threshold: 1,
        summary: "ä¸€éƒ¨ã®å½¢å¼çš„è¦ä»¶ã«ç¢ºèªä¸è¶³ãŒã‚ã‚Šã¾ã™ã€‚"
      },
      green: {
        summary: "å½¢å¼çš„ãªä½“åˆ¶ãƒ»æ›¸é¡ã¯æ¦‚ã­æ•´å‚™ã•ã‚Œã¦ã„ã¾ã™ã€‚"
      }
    },

    questions: [
      { id: "c_notice", text: "å¿…è¦ãªæ²ç¤ºç‰©ã‚’æ²ç¤ºã—ã¦ã„ã¾ã™ã‹ï¼Ÿ", documents: ["æ²ç¤ºç‰©"] },
      { id: "c_staffing", text: "å‹¤å‹™ä½“åˆ¶è¡¨ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã‹ï¼Ÿ", documents: ["å‹¤å‹™ä½“åˆ¶è¡¨"] },
      { id: "c_manager", text: "ç®¡ç†è€…ã‚’é¸ä»»ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ", documents: ["ç®¡ç†è€…é¸ä»»è¨˜éŒ²"] },
      { id: "c_disaster", text: "ç½å®³å¯¾å¿œãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚’æ•´å‚™ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ", documents: ["ç½å®³å¯¾å¿œãƒãƒ‹ãƒ¥ã‚¢ãƒ«"] },
      { id: "c_hygiene", text: "è¡›ç”Ÿç®¡ç†è¨˜éŒ²ã‚’æ•´å‚™ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ", documents: ["è¡›ç”Ÿç®¡ç†è¨˜éŒ²"] },
      { id: "c_training", text: "ç ”ä¿®è¨˜éŒ²ã‚’æ®‹ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ", documents: ["ç ”ä¿®å®Ÿæ–½è¨˜éŒ²"] }
    ]
  }
];

// ================================
// åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
// ================================

function evaluateSection(section, answers) {
  let riskCount = 0;

  const questions = section.questions.map(q => {
    const ans = answers[q.id] || (section.bulk ? "no" : "unknown");

    if (ans === "no") riskCount += 2;
    if (ans === "unknown") riskCount += 1;

    return {
      text: q.text,
      answer: ans,
      feedback: q.feedback ? q.feedback[ans] : "",
      documents: q.documents || []
    };
  });

  const j = section.judgment;

  let riskLevel = "ğŸŸ¢ æ¦‚ã­è‰¯å¥½";
  let summary = j.green.summary;

  if (riskCount >= j.red.threshold) {
    riskLevel = section.critical ? "ğŸ”´ è¦æ³¨æ„ï¼ˆé‡ç‚¹ç¢ºèªï¼‰" : "ğŸ”´ è¦æ³¨æ„";
    summary = j.red.summary;
  } else if (riskCount >= j.yellow.threshold) {
    riskLevel = "ğŸŸ¡ è¦ç¢ºèª";
    summary = j.yellow.summary;
  }

  return { riskLevel, summary, questions };
}

function renderSectionResult(sectionIndex, result) {
  const el = document.getElementById(`result-${sectionIndex}`);
  if (!el) return;

  el.innerHTML = `
    <strong>åˆ¤å®šï¼š</strong>${result.riskLevel}<br>
    <div style="margin:6px 0;">${result.summary}</div>
    <hr>
  `;

  result.questions.forEach(q => {
    el.innerHTML += `
      <div style="margin-bottom:12px;">
        <div><strong>Qï¼š</strong>${q.text}</div>
        <div style="margin-left:1em;">
          <strong>å›ç­”ï¼š</strong>${ANSWER_LABEL[q.answer] || "æœªå›ç­”"}
        </div>
        ${q.feedback ? `<div>â¡ ${q.feedback}</div>` : ""}
        ${
          q.documents.length
            ? `<div style="font-size:14px;color:#555;">ğŸ“„ ${q.documents.join("ã€")}</div>`
            : ""
        }
      </div>
    `;
  });
}

