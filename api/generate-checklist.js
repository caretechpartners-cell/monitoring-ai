// ================================
// å®Ÿåœ°æŒ‡å°ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆAI
// generate-checklist.js
// ================================

// --------------------------------
// è³ªå•ã‚»ãƒƒãƒˆå®šç¾©
// --------------------------------
export const CHECKLIST_QUESTIONS = [
  // ========= SECTION 1ï¼šç¬¬27æ¡ã®2ï¼ˆè™å¾…é˜²æ­¢ï¼‰ =========
  {
    section: "ç¬¬27æ¡ã®2ï¼ˆè™å¾…é˜²æ­¢ï¼‰",
    critical: true, // â† æœ€é‡è¦æ¡æ–‡
    questions: [
      { id: "27_2_01", text: "è™å¾…é˜²æ­¢ã®ãŸã‚ã®å¯¾ç­–ã‚’æ¤œè¨ã™ã‚‹å§”å“¡ä¼šã‚’è¨­ç½®ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ" },
      { id: "27_2_02", text: "è™å¾…é˜²æ­¢å§”å“¡ä¼šã¯å®šæœŸçš„ï¼ˆå¹´1å›ä»¥ä¸Šï¼‰ã«é–‹å‚¬ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ" },
      { id: "27_2_03", text: "è™å¾…é˜²æ­¢å§”å“¡ä¼šã®é–‹å‚¬è¨˜éŒ²ï¼ˆè­°äº‹éŒ²ï¼‰ã¯ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ" },
      { id: "27_2_04", text: "è™å¾…é˜²æ­¢ã®ãŸã‚ã®æŒ‡é‡ï¼ˆæ–‡æ›¸ï¼‰ã¯æ•´å‚™ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ" },
      { id: "27_2_05", text: "è™å¾…é˜²æ­¢ã«é–¢ã™ã‚‹ç ”ä¿®ã‚’å®šæœŸçš„ã«å®Ÿæ–½ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ" },
      { id: "27_2_06", text: "è™å¾…é˜²æ­¢ã®å–çµ„ã‚’å®Ÿæ–½ã™ã‚‹æ‹…å½“è€…ã¯æ˜ç¢ºã«å®šã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ" }
    ]
  },

  // ========= SECTION 2ï¼šç¬¬4æ¡ =========
  {
    section: "ç¬¬4æ¡ï¼ˆå†…å®¹åŠã³æ‰‹ç¶šã®èª¬æ˜ãƒ»åŒæ„ï¼‰",
    critical: false,
    questions: [
      { id: "04_01", text: "é‡è¦äº‹é …èª¬æ˜æ›¸ã‚’äº¤ä»˜ã—ã€èª¬æ˜ã‚’è¡Œã£ã¦ã„ã¾ã™ã‹ï¼Ÿ" },
      { id: "04_02", text: "é‡è¦äº‹é …èª¬æ˜æ›¸ã®å†…å®¹ã«ä¸å‚™ãƒ»å¤ã„è¨˜è¼‰ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ" },
      { id: "04_03", text: "èª¬æ˜å¾Œã€æ–‡æ›¸ã«ã‚ˆã‚‹åŒæ„ã‚’å¾—ã¦ã„ã¾ã™ã‹ï¼Ÿ" },
      { id: "04_04", text: "èª¬æ˜ãƒ»åŒæ„ãŒåˆ†ã‹ã‚‹è¨˜éŒ²ï¼ˆç½²åç­‰ï¼‰ã¯ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ" }
    ]
  },

  // ========= SECTION 3ï¼šç¬¬13æ¡ =========
  {
    section: "ç¬¬13æ¡ï¼ˆæŒ‡å®šå±…å®…ä»‹è­·æ”¯æ´ã®å…·ä½“çš„å–æ‰±æ–¹é‡ï¼‰",
    critical: false,
    questions: [
      { id: "13_01", text: "å±…å®…è¨ªå•ãƒ»é¢æ¥ã«ã‚ˆã‚‹ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã‚’è¡Œã£ã¦ã„ã¾ã™ã‹ï¼Ÿ" },
      { id: "13_02", text: "ã‚µãƒ¼ãƒ“ã‚¹æ‹…å½“è€…ä¼šè­°ã‚’é–‹å‚¬ã—ã€å°‚é–€çš„æ„è¦‹ã‚’æ±‚ã‚ã¦ã„ã¾ã™ã‹ï¼Ÿ" },
      { id: "13_03", text: "å±…å®…ã‚µãƒ¼ãƒ“ã‚¹è¨ˆç”»åŸæ¡ˆã«ã¤ã„ã¦èª¬æ˜ã—ã€åŒæ„ã‚’å¾—ã¦ã„ã¾ã™ã‹ï¼Ÿ" },
      { id: "13_04", text: "æœˆ1å›ä»¥ä¸Šã®ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã„ã€è¨˜éŒ²ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ" },
      { id: "13_05", text: "è¨ˆç”»å¤‰æ›´æ™‚ã«å†åº¦ã‚µãƒ¼ãƒ“ã‚¹æ‹…å½“è€…ä¼šè­°ã‚’é–‹å‚¬ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ" }
    ]
  },

  // ========= SECTION 4ï¼šç¬¬18æ¡ =========
  {
    section: "ç¬¬18æ¡ï¼ˆé‹å–¶è¦ç¨‹ï¼‰",
    critical: false,
    questions: [
      { id: "18_01", text: "é‹å–¶è¦ç¨‹ã‚’æ•´å‚™ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ" },
      { id: "18_02", text: "é‹å–¶è¦ç¨‹ã¯ç¾åœ¨ã®æ³•ä»¤ãƒ»é‹å–¶å®Ÿæ…‹ã«åˆã£ã¦ã„ã¾ã™ã‹ï¼Ÿ" },
      { id: "18_03", text: "è™å¾…é˜²æ­¢ãƒ»ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆé˜²æ­¢ç­‰ã®é …ç›®ãŒæ˜è¨˜ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ" },
      { id: "18_04", text: "é‹å–¶è¦ç¨‹ã®æœ€çµ‚æ›´æ–°æ™‚æœŸã‚’æŠŠæ¡ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ" }
    ]
  }
];

// --------------------------------
// åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
// answers = { questionId: "yes" | "no" | "unknown" }
// --------------------------------
export function evaluateChecklist(answers) {
  const results = [];

  for (const section of CHECKLIST_QUESTIONS) {
    let riskCount = 0;
    let total = section.questions.length;

    section.questions.forEach(q => {
      const ans = answers[q.id];
      if (ans === "no" || ans === "unknown") {
        riskCount++;
      }
    });

    // ãƒªã‚¹ã‚¯åˆ¤å®š
    let riskLevel = "ğŸŸ¢ ä½ãƒªã‚¹ã‚¯";

    if (section.critical) {
      if (riskCount >= 2) riskLevel = "ğŸ”´ é«˜ãƒªã‚¹ã‚¯";
      else if (riskCount === 1) riskLevel = "ğŸŸ¡ æ³¨æ„";
    } else {
      if (riskCount >= 3) riskLevel = "ğŸ”´ é«˜ãƒªã‚¹ã‚¯";
      else if (riskCount >= 1) riskLevel = "ğŸŸ¡ æ³¨æ„";
    }

    results.push({
      section: section.section,
      total,
      riskCount,
      riskLevel,
      comment: generateComment(section.section, riskLevel)
    });
  }

  return results;
}

// --------------------------------
// ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆï¼ˆæœ€å°å®Ÿè£…ï¼‰
// --------------------------------
function generateComment(sectionName, riskLevel) {
  if (sectionName.includes("ç¬¬27æ¡ã®2")) {
    if (riskLevel.startsWith("ğŸ”´")) {
      return "è™å¾…é˜²æ­¢ä½“åˆ¶ã¯å®Ÿåœ°æŒ‡å°ã§ç‰¹ã«å³ã—ãç¢ºèªã•ã‚Œã¾ã™ã€‚å§”å“¡ä¼šãƒ»ç ”ä¿®ãƒ»æŒ‡é‡ãƒ»æ‹…å½“è€…ã®4ç‚¹ã‚’å„ªå…ˆçš„ã«ç‚¹æ¤œã—ã¦ãã ã•ã„ã€‚";
    }
    if (riskLevel.startsWith("ğŸŸ¡")) {
      return "è™å¾…é˜²æ­¢ä½“åˆ¶ã«ä¸€éƒ¨ç¢ºèªä¸è¶³ãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚è¨˜éŒ²ã‚„å®Ÿæ–½çŠ¶æ³ã‚’äº‹å‰ã«æ•´ç†ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚";
    }
    return "è™å¾…é˜²æ­¢ä½“åˆ¶ã¯æ¦‚ã­æ•´å‚™ã•ã‚Œã¦ã„ã¾ã™ã€‚";
  }

  if (riskLevel.startsWith("ğŸ”´")) {
    return "å®Ÿåœ°æŒ‡å°ã§æŒ‡æ‘˜ã‚’å—ã‘ã‚‹å¯èƒ½æ€§ãŒé«˜ã„çŠ¶æ…‹ã§ã™ã€‚è¨˜éŒ²ãƒ»åŒæ„ãƒ»ä½“åˆ¶ã®å†ç¢ºèªã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚";
  }

  if (riskLevel.startsWith("ğŸŸ¡")) {
    return "ä¸€éƒ¨ç¢ºèªä¸è¶³ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚æ›¸é¡ãƒ»è¨˜éŒ²ã®è¦‹ç›´ã—ã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚";
  }

  return "å¤§ããªå•é¡Œã¯è¦‹ã‚‰ã‚Œã¾ã›ã‚“ã€‚";
}
