<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚„ã•ã—ã„æ–½è¨­ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è©•ä¾¡æ•´ç†AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link
    href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap"
    rel="stylesheet"
  >

  <style>
    body {
      margin: 0;
      font-family: "M PLUS Rounded 1c", sans-serif;
      background: #e9f6fb;
    }

    .container {
      max-width: 900px;
      margin: 40px auto;
      background: #ffffff;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }

    .main-title {
      font-size: 30px;
      font-weight: 700;
      line-height: 1.4;
      text-align: center;
      color: #2a6f97;
    }

    .subtitle {
      display: block;
      font-size: 22px;
      font-weight: 600;
      margin-top: 6px;
    }

    .powered {
      text-align: center;
      font-size: 16px;
      color: #777;
      margin-bottom: 10px;
    }

    .limit {
      text-align: center;
      font-size: 18px;
      color: #2a6f97;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .guide {
      background: #fff4f6;
      border: 2px dashed #f3a6b1;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      font-size: 18px;
      line-height: 1.8;
    }

    label {
      display: block;
      font-size: 20px;
      margin-top: 28px;
      margin-bottom: 8px;
      color: #2a6f97;
      font-weight: bold;
    }

    select, textarea {
      width: 100%;
      font-size: 18px;
      padding: 12px;
      border-radius: 10px;
      border: 2px solid #cfdfe8;
      box-sizing: border-box;
    }

    textarea {
      min-height: 90px;
    }

    textarea::placeholder {
      color: #999;
      font-size: 16px;
    }

    .btn {
      width: 100%;
      height: 70px;
      font-size: 22px;
      border: none;
      border-radius: 16px;
      margin-top: 30px;
      cursor: pointer;
      background: #2a6f97;
      color: white;
    }

    .sample-btn {
      background: #f3a6b1;
      margin-top: 10px;
    }

    .result-box {
      margin-top: 35px;
      font-size: 18px;
      background: #f7fbff;
      border-radius: 12px;
      padding: 22px;
      line-height: 1.7;
      white-space: pre-wrap;
    }

    .footer-links {
      margin-top: 60px;
      margin-bottom: 20px;
      text-align: center;
      font-size: 12px;
      color: #999;
    }

    .footer-links a {
      color: #777;
      text-decoration: none;
      margin: 0 6px;
    }
  </style>
</head>

<body>
<div class="container">

  <h1 class="main-title">
    ã‚„ã•ã—ã„æ–½è¨­ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è©•ä¾¡æ•´ç†AI
    <span class="subtitle">ï½æ–½è¨­ã‚±ã‚¢ãƒãƒã®åˆ¤æ–­ã‚’ã€èª¬æ˜ã§ãã‚‹å½¢ã«æ•´ç†ï½</span>
  </h1>

  <div class="powered">Powered by ã‚±ã‚¢ãƒ†ãƒƒã‚¯ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º</div>
  <div class="limit" id="limitText"></div>

  <div class="guide">
    âœ… ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã§æŠŠæ¡ã—ãŸã€Œäº‹å®Ÿã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„<br>
    âœ… AIã¯è©•ä¾¡ãƒ»åˆ¤æ–­ã‚’æ•´ç†ã—ã¾ã™ï¼ˆåˆ¤æ–­ã®ä¸»ä½“ã¯æ–½è¨­ã‚±ã‚¢ãƒãƒã§ã™ï¼‰<br>
    âœ… å®Ÿåœ°æŒ‡å°ãƒ»ç›£æŸ»ã§èª¬æ˜ã§ãã‚‹æ§‹é€ ã§å‡ºåŠ›ã•ã‚Œã¾ã™
  </div>

  <button class="btn sample-btn" onclick="insertSample()">ã‚µãƒ³ãƒ—ãƒ«åˆ©ç”¨è€…ã‚’å…¥åŠ›</button>

  <!-- å…¥åŠ›UI -->
  <label>â–  æ–½è¨­ç¨®åˆ¥</label>
  <select id="facilityType">
    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
    <option>ç‰¹åˆ¥é¤Šè­·è€äººãƒ›ãƒ¼ãƒ </option>
    <option>ä»‹è­·è€äººä¿å¥æ–½è¨­</option>
    <option>æœ‰æ–™è€äººãƒ›ãƒ¼ãƒ </option>
    <option>èªçŸ¥ç—‡å¯¾å¿œå‹å…±åŒç”Ÿæ´»ä»‹è­·</option>
  </select>

  <label>â–  åˆ©ç”¨è€…ã®åŸºæœ¬æƒ…å ±ï¼ˆæœ€å°é™ï¼‰</label>
  <textarea id="basicInfo"
  placeholder="ä¾‹ï¼šè¦ä»‹è­·4ã€‚è„³è¡€ç®¡æ€§èªçŸ¥ç—‡ã‚ã‚Šã€‚
ADLã¯å…¨èˆ¬çš„ã«ä½ä¸‹ã—ã¦ãŠã‚Šã€ç§»å‹•ãƒ»æ’æ³„ã¯ä¸€éƒ¨ä»‹åŠ©ã‚’è¦ã™ã‚‹ã€‚
åš¥ä¸‹æ©Ÿèƒ½ä½ä¸‹ãŒã¿ã‚‰ã‚Œã‚‹ãŸã‚ã€é£Ÿäº‹å½¢æ…‹ã«ç•™æ„ã—ã¦ã„ã‚‹ã€‚">
</textarea>


  <label>â–  ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°äº‹å®Ÿï¼ˆè¦³å¯Ÿãƒ»æŠŠæ¡ã—ãŸäº‹å®Ÿï¼‰</label>
  <textarea id="monitoringFacts"
  placeholder="ä¾‹ï¼š
ãƒ»æ—¥ä¸­ã¯å±…å®¤å†…ã§éã”ã™æ™‚é–“ãŒå¤šã„ãŒã€å£°ã‹ã‘ã«ã‚ˆã‚Šé£Ÿå ‚ã¸ç§»å‹•ã§ãã‚‹å ´é¢ãŒã¿ã‚‰ã‚Œã‚‹
ãƒ»é£Ÿäº‹æ‘‚å–é‡ã¯æ—¥ã«ã‚ˆã£ã¦ã°ã‚‰ã¤ããŒã‚ã‚‹
ãƒ»å…¥æµ´æ™‚ã«ä¸å®‰ã‚’è¨´ãˆã€æ‹’å¦çš„ãªè¨€å‹•ãŒã¿ã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹">
</textarea>


  <label>â–  å¤šè·ç¨®ã‹ã‚‰ã®æƒ…å ±</label>

<label style="font-size:16px; color:#555; margin-top:12px;">ã€ä»‹è­·è·ã€‘</label>
<textarea id="infoCare"
  placeholder="ä¾‹ï¼šå¤œé–“è¦šé†’ãŒã¿ã‚‰ã‚Œã€å£°ã‹ã‘ã«ã‚ˆã‚Šè½ã¡ç€ãå ´é¢ãŒã‚ã‚‹ã€‚"></textarea>

<label style="font-size:16px; color:#555; margin-top:18px;">ã€åŒ»ç™‚ãƒ»çœ‹è­·è·ã€‘</label>
<textarea id="infoNurse"
  placeholder="ä¾‹ï¼šãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³ã¯æ¦‚ã­å®‰å®šã€‚æœè–¬çŠ¶æ³ã«å•é¡Œã¯èªã‚ã‚‰ã‚Œã¦ã„ãªã„ã€‚"></textarea>

<label style="font-size:16px; color:#555; margin-top:18px;">ã€ãƒªãƒè·ã€‘</label>
<textarea id="infoRehab"
  placeholder="ä¾‹ï¼šç«‹ã¡ä¸ŠãŒã‚Šå‹•ä½œã¯è¦‹å®ˆã‚Šã§å¯èƒ½ã€‚ç§»å‹•æ™‚ã¯è»¢å€’ãƒªã‚¹ã‚¯ã«ç•™æ„ãŒå¿…è¦ã€‚"></textarea>


  <label>â–  ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ä¸Šã®ç›®æ¨™</label>
  <textarea id="planGoal"
  placeholder="ä¾‹ï¼šæ–½è¨­å†…ã«ãŠã„ã¦å®‰å¿ƒã—ã¦ç”Ÿæ´»ã§ãã‚‹ç’°å¢ƒã‚’æ•´ãˆã€
å¿ƒèº«ã®çŠ¶æ…‹ã«é…æ…®ã—ãªãŒã‚‰å®‰å®šã—ãŸç”Ÿæ´»ã‚’ç¶™ç¶šã§ãã‚‹ã‚ˆã†æ”¯æ´ã™ã‚‹ã€‚">
</textarea>


  <label>â–  ä»Šå›ã€ç‰¹ã«ç¢ºèªã—ãŸã„ãƒã‚¤ãƒ³ãƒˆ</label>
  <textarea id="checkPoint"
  placeholder="ä¾‹ï¼šå¤œé–“ã®è¦šé†’çŠ¶æ³ã¨å®‰å…¨é¢ã¸ã®å½±éŸ¿ã€
å…¥æµ´æ™‚ã®ä¸å®‰ã‚„æ‹’å¦çš„åå¿œã¸ã®å¯¾å¿œçŠ¶æ³">
</textarea>


  <button class="btn" onclick="runEvaluation()">AIã§è©•ä¾¡æ•´ç†ã‚’è¡Œã†</button>

  <div id="result" class="result-box"></div>

<div
  id="memberGuide"
  style="
    display:none;
    margin-top:22px;
    padding:20px;
    border-radius:14px;
    background:#f0f8ff;
    font-size:17px;
    line-height:1.8;
  "
>
  ãƒ»ä¼šå“¡ç‰ˆã§ã¯ã€å›æ•°åˆ¶é™ãªãæ–½è¨­ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è©•ä¾¡æ•´ç†ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚<br>
  ãƒ»å®Ÿåœ°æŒ‡å°ãƒ»ç›£æŸ»ã‚’æƒ³å®šã—ãŸè¡¨ç¾ã§ã€èª¬æ˜ã—ã‚„ã™ã„è¨˜éŒ²ã‚’æ•´ç†ã—ã¾ã™ã€‚<br>
  ãƒ»åˆ¤æ–­ã¯è¡Œã‚ãšã€æ–½è¨­ã‚±ã‚¢ãƒãƒã®åˆ¤æ–­ã‚’æ”¯ãˆã‚‹æ–‡ç« æ§‹æˆã§ã™ã€‚<br><br>

  <a
    href="lp-facility.html"
    style="
      display:block;
      text-align:center;
      font-weight:bold;
      font-size:18px;
      color:#2a6f97;
      text-decoration:none;
      padding:12px;
      border-radius:10px;
      background:#ffffff;
      border:2px solid #2a6f97;
    "
  >
    â–¶ ä¼šå“¡ç‰ˆã®åˆ©ç”¨å†…å®¹ã‚’ç¢ºèªã™ã‚‹
  </a>
</div>


</div>

<div class="footer-links">
  <a href="privacy.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>ï½œ
  <a href="terms.html">åˆ©ç”¨è¦ç´„</a>ï½œ
  <a href="tokusho.html">ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜</a>
</div>

<script>
/* ===== ç„¡æ–™ä½“é¨“å›æ•°ç®¡ç† ===== */
const LIMIT = 3;
let progressTimer = null;
let progressValue = 0;

function initLimit() {
  if (!localStorage.getItem("facility_remain")) {
    localStorage.setItem("facility_remain", LIMIT);
  }
  updateLimit();
}

function updateLimit() {
  const remain = Number(localStorage.getItem("facility_remain"));
  limitText.textContent =
    remain > 0
      ? `ğŸŒ· ç„¡æ–™ã§ã‚ã¨ã€Œ${remain}å›ã€ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™`
      : "ç„¡æ–™ä½“é¨“ã¯çµ‚äº†ã—ã¾ã—ãŸã€‚";
}

initLimit();

/* ===== ã‚µãƒ³ãƒ—ãƒ«å…¥åŠ› ===== */
function insertSample() {
  facilityType.value = "ç‰¹åˆ¥é¤Šè­·è€äººãƒ›ãƒ¼ãƒ ";

  basicInfo.value =
    "è¦ä»‹è­·4ã€‚è„³è¡€ç®¡æ€§èªçŸ¥ç—‡ã‚ã‚Šã€‚\n" +
    "ADLã¯å…¨èˆ¬çš„ã«ä½ä¸‹ã—ã¦ãŠã‚Šã€ç§»å‹•ãƒ»æ’æ³„ã¯ä¸€éƒ¨ä»‹åŠ©ã‚’è¦ã™ã‚‹ã€‚\n" +
    "åš¥ä¸‹æ©Ÿèƒ½ä½ä¸‹ãŒã¿ã‚‰ã‚Œã‚‹ãŸã‚ã€é£Ÿäº‹å½¢æ…‹ã«ç•™æ„ã—ã¦ã„ã‚‹ã€‚";

  monitoringFacts.value =
    "ãƒ»æ—¥ä¸­ã¯å±…å®¤å†…ã§éã”ã™æ™‚é–“ãŒå¤šã„ãŒã€å£°ã‹ã‘ã«ã‚ˆã‚Šé£Ÿå ‚ã¸ç§»å‹•ã§ãã‚‹å ´é¢ãŒã¿ã‚‰ã‚Œã‚‹\n" +
    "ãƒ»é£Ÿäº‹æ‘‚å–é‡ã¯æ—¥ã«ã‚ˆã£ã¦ã°ã‚‰ã¤ããŒã‚ã‚‹\n" +
    "ãƒ»å…¥æµ´æ™‚ã«ä¸å®‰ã‚’è¨´ãˆã€æ‹’å¦çš„ãªè¨€å‹•ãŒã¿ã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹";

  infoCare.value =
    "å¤œé–“ã«è¦šé†’ã—ã€å±…å®¤å†…ã‚’æ­©ã“ã†ã¨ã™ã‚‹æ§˜å­ãŒã¿ã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚";

  infoNurse.value =
    "ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³ã¯æ¦‚ã­å®‰å®šã—ã¦ãŠã‚Šã€æœè–¬çŠ¶æ³ã«å•é¡Œã¯èªã‚ã‚‰ã‚Œã¦ã„ãªã„ã€‚";

  infoRehab.value =
    "ä¸‹è‚¢ç­‹åŠ›ä½ä¸‹ãŒã¿ã‚‰ã‚Œã€ç«‹ã¡ä¸ŠãŒã‚Šæ™‚ã¯è¦‹å®ˆã‚ŠãŒå¿…è¦ã€‚";

  planGoal.value =
    "æ–½è¨­å†…ã«ãŠã„ã¦å®‰å¿ƒã—ã¦ç”Ÿæ´»ã§ãã‚‹ç’°å¢ƒã‚’æ•´ãˆã€\nå¿ƒèº«ã®çŠ¶æ…‹ã«é…æ…®ã—ãªãŒã‚‰å®‰å®šã—ãŸç”Ÿæ´»ã‚’ç¶™ç¶šã§ãã‚‹ã‚ˆã†æ”¯æ´ã™ã‚‹ã€‚";

  checkPoint.value =
    "å¤œé–“ã®è¦šé†’çŠ¶æ³ã¨å®‰å…¨é¢ã¸ã®å½±éŸ¿ã€\nå…¥æµ´æ™‚ã®ä¸å®‰ã‚„æ‹’å¦çš„åå¿œã¸ã®å¯¾å¿œæ–¹æ³•";
}

/* ===== é€²æ—è¡¨ç¤º ===== */
function startProgress() {
  progressValue = 0;
  result.textContent = "ç”Ÿæˆä¸­â€¦ 0%";

  progressTimer = setInterval(() => {
    if (progressValue < 98) {
      progressValue += progressValue < 70 ? 4 : progressValue < 90 ? 2 : 1;
      if (progressValue >= 90) {
        result.textContent = "æ–‡ç« ã‚’æ•´ãˆã¦ã„ã¾ã™â€¦";
      } else {
        result.textContent = `ç”Ÿæˆä¸­â€¦ ${progressValue}%`;
      }
    }
  }, 300);
}

function finishProgress() {
  if (progressTimer) clearInterval(progressTimer);
  result.textContent = "ç”Ÿæˆå®Œäº†ï¼ˆ100%ï¼‰";
}

/* ===== è©•ä¾¡æ•´ç†å®Ÿè¡Œ ===== */
async function runEvaluation() {
  let remain = Number(localStorage.getItem("facility_remain"));
  if (remain <= 0) {
    alert("ç„¡æ–™ä½“é¨“ã¯çµ‚äº†ã—ã¾ã—ãŸã€‚");
    return;
  }

  const payload = {
    facilityType: facilityType.value,
    basicInfo: basicInfo.value,
    monitoringFacts: monitoringFacts.value,
    multiDisciplinaryInfo: {
      care: infoCare.value,
      nurse: infoNurse.value,
      rehab: infoRehab.value
    },
    planGoal: planGoal.value,
    checkPoint: checkPoint.value
  };

  startProgress();

try {
  const res = await fetch("/api/generate-facility-eval", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  const data = await res.json();
  finishProgress();

  result.textContent = data.result || "å‡ºåŠ›ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";

  // LPèª˜å°ã‚’è¡¨ç¤º
  document.getElementById("memberGuide").style.display = "block";

  // å›æ•°ã‚’1å›ã ã‘æ¸›ã‚‰ã™
  localStorage.setItem("facility_remain", --remain);
  updateLimit();

} catch (e) {
  if (progressTimer) clearInterval(progressTimer);
  result.textContent = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
}
}

/* ===== ç®¡ç†è€…éš ã—ã‚³ãƒãƒ³ãƒ‰ ===== */
document.addEventListener("keydown", e => {
  if (e.ctrlKey && e.shiftKey && e.key === "R") {
    if (prompt("ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰") === "admin123") {
      localStorage.setItem("facility_remain", LIMIT);
      alert("ç„¡æ–™å›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ");
      location.reload();
    }
  }
});
</script>

</body>
</html>
