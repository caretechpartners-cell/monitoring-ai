<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚„ã•ã—ã„æ–½è¨­ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è©•ä¾¡æ•´ç†AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
      font-family: "M PLUS Rounded 1c", sans-serif;
      background: #e9f6fb;
    }
    .container {
      max-width: 900px;
      margin: 40px auto;
      background: #ffffff;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    .main-title {
      font-size: 30px;
      font-weight: 700;
      text-align: center;
      color: #2a6f97;
      line-height: 1.4;
    }
    .subtitle {
      display: block;
      font-size: 22px;
      margin-top: 6px;
    }
    .powered {
      text-align: center;
      font-size: 16px;
      color: #777;
      margin-bottom: 10px;
    }
    .limit {
      text-align: center;
      font-size: 18px;
      color: #2a6f97;
      font-weight: bold;
      margin-bottom: 25px;
    }
    .guide {
      background: #fff4f6;
      border: 2px dashed #f3a6b1;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      font-size: 18px;
      line-height: 1.8;
    }
    label {
      display: block;
      font-size: 20px;
      margin-top: 25px;
      margin-bottom: 6px;
    }
    textarea {
      width: 100%;
      height: 110px;
      font-size: 18px;
      padding: 12px;
      border-radius: 10px;
      border: 2px solid #cfdfe8;
    }
    textarea::placeholder {
      color: #999;
      font-size: 16px;
    }
    .btn {
      width: 100%;
      height: 70px;
      font-size: 22px;
      border: none;
      border-radius: 16px;
      margin-top: 25px;
      cursor: pointer;
    }
    .sample-btn { background: #f3a6b1; color: white; }
    .generate-btn { background: #2a6f97; color: white; }

    .result-box {
      margin-top: 30px;
      font-size: 18px;
      background: #f7fbff;
      border-radius: 12px;
      padding: 20px;
      white-space: pre-wrap;
    }

    .copy-guide {
      margin-top: 15px;
      font-size: 18px;
      color: #2a6f97;
      font-weight: bold;
      display: none;
    }
  </style>
</head>
<body>

<div class="container">
  <h1 class="main-title">
    ã‚„ã•ã—ã„æ–½è¨­ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è©•ä¾¡æ•´ç†AI
    <span class="subtitle">ï½åˆ¤æ–­ã‚’å¥ªã‚ãšã€èª¬æ˜ã§ãã‚‹è¨˜éŒ²ã¸ï½</span>
  </h1>

  <div class="powered">Powered by ã‚±ã‚¢ãƒ†ãƒƒã‚¯ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º</div>
  <div class="limit" id="limitText"></div>

  <div class="guide">
    âœ… è¦³å¯Ÿäº‹å®Ÿãƒ»å¤šè·ç¨®æƒ…å ±ã‚’å…¥åŠ›<br>
    âœ… AIãŒè©•ä¾¡æ§‹é€ ã‚’æ•´ç†ï¼ˆåˆ¤æ–­ã¯è¡Œã„ã¾ã›ã‚“ï¼‰<br>
    âœ… ç¬¬6è¡¨ï¼ˆæ–½è¨­ä»‹è­·æ”¯æ´çµŒéï¼‰ã¸ã®è»¢è¨˜ã‚’æƒ³å®š
  </div>

  <button class="btn sample-btn" onclick="insertSample()">ã‚µãƒ³ãƒ—ãƒ«åˆ©ç”¨è€…ã‚’å…¥åŠ›</button>

  <label>â–  æ–½è¨­ç¨®åˆ¥</label>
  <textarea id="facilityType" placeholder="ä¾‹ï¼šèªçŸ¥ç—‡å¯¾å¿œå‹å…±åŒç”Ÿæ´»ä»‹è­·"></textarea>

  <label>â–  åˆ©ç”¨è€…ã®åŸºæœ¬æƒ…å ±ï¼ˆæœ€å°é™ï¼‰</label>
  <textarea id="basic" placeholder="ä¾‹ï¼šè¦ä»‹è­·3ã€‚è„³æ¢—å¡å¾Œéºç—‡ã‚ã‚Šã€‚åš¥ä¸‹æ©Ÿèƒ½ä½ä¸‹ã«ç•™æ„ã€‚"></textarea>

  <label>â–  ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°äº‹å®Ÿï¼ˆè¦³å¯Ÿãƒ»æŠŠæ¡ã—ãŸäº‹å®Ÿï¼‰</label>
  <textarea id="fact" placeholder="ä¾‹ï¼š
ãƒ»æ—¥ä¸­ã¯å±…å®¤å¤–ã§éã”ã™æ™‚é–“ãŒå¢—ãˆã¦ã„ã‚‹
ãƒ»é£Ÿäº‹æ‘‚å–é‡ã¯æ¦‚ã­å®‰å®š
ãƒ»å…¥æµ´æ™‚ã«æ‹’å¦çš„ãªå ´é¢ã‚ã‚Š"></textarea>

  <label>â–  å¤šè·ç¨®ã‹ã‚‰ã®æƒ…å ±</label>
  <textarea id="team" placeholder="ã€ä»‹è­·è·ã€‘ä¾‹ï¼šå¤œé–“è¦šé†’ãŒå¢—ãˆã¦ã„ã‚‹ã¨ã®å ±å‘Šã‚ã‚Š

ã€çœ‹è­·è·ã€‘ä¾‹ï¼šãƒã‚¤ã‚¿ãƒ«å®‰å®šã€æœè–¬çŠ¶æ³å•é¡Œãªã—

ã€ãƒªãƒè·ã€‘ä¾‹ï¼šç«‹ã¡ä¸ŠãŒã‚Šå‹•ä½œã¯è¦‹å®ˆã‚Šã§å¯èƒ½"></textarea>

  <label>â–  ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ä¸Šã®ç›®æ¨™</label>
  <textarea id="goal" placeholder="ä¾‹ï¼šæ–½è¨­ç”Ÿæ´»ã¸ã®é©å¿œã‚’å›³ã‚Šã€å®‰å®šã—ãŸç”Ÿæ´»ã‚’ç¶™ç¶šã™ã‚‹"></textarea>

  <label>â–  ä»Šå›ã€ç‰¹ã«ç¢ºèªã—ãŸã„ãƒã‚¤ãƒ³ãƒˆ</label>
  <textarea id="focus" placeholder="ä¾‹ï¼šé›†å›£ç”Ÿæ´»ã¸ã®é©å¿œçŠ¶æ³ã€æ‹’å¦è¡Œå‹•ã®æœ‰ç„¡"></textarea>

  <button class="btn generate-btn" onclick="generate()">AIã§è©•ä¾¡æ•´ç†ã‚’è¡Œã†</button>

  <div class="copy-guide" id="copyGuide">
    ã“ã®ã¾ã¾ã‚³ãƒ”ãƒ¼ã—ã¦ã€æ–½è¨­ä»‹è­·æ”¯æ´çµŒéï¼ˆç¬¬6è¡¨ï¼‰ã«ã”æ´»ç”¨ãã ã•ã„ã€‚
  </div>

  <div id="result" class="result-box"></div>
</div>

<script>
let progressTimer = null;
let progressValue = 0;
const LIMIT = 3;

function startProgress() {
  progressValue = 0;
  result.textContent = "ç”Ÿæˆä¸­â€¦ 0%";
  progressTimer = setInterval(() => {
    if (progressValue < 98) {
      progressValue += progressValue < 70 ? 4 : progressValue < 90 ? 2 : 1;
      if (progressValue >= 90) {
        result.textContent = "æ–‡ç« ã‚’æ•´ãˆã¦ã„ã¾ã™â€¦";
      } else {
        result.textContent = `ç”Ÿæˆä¸­â€¦ ${progressValue}%`;
      }
    }
  }, 300);
}

function finishProgress() {
  clearInterval(progressTimer);
  result.textContent = "ç”Ÿæˆå®Œäº†ï¼ˆ100%ï¼‰";
}

function initLimit() {
  if (!localStorage.getItem("facility_remain")) {
    localStorage.setItem("facility_remain", LIMIT);
  }
  updateLimit();
}

function updateLimit() {
  const remain = Number(localStorage.getItem("facility_remain"));
  limitText.textContent =
    remain > 0 ? `ğŸŒ· ç„¡æ–™ã§ã‚ã¨ã€Œ${remain}å›ã€ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™` : "ç„¡æ–™ä½“é¨“ã¯çµ‚äº†ã—ã¾ã—ãŸ";
}

initLimit();

function insertSample() {
  facilityType.value = "ä»‹è­·è€äººç¦ç¥‰æ–½è¨­ï¼ˆç‰¹åˆ¥é¤Šè­·è€äººãƒ›ãƒ¼ãƒ ï¼‰";

  basic.value =
    "è¦ä»‹è­·4ã€‚è„³è¡€ç®¡æ€§èªçŸ¥ç—‡ã‚ã‚Šã€‚\n" +
    "ADLã¯å…¨èˆ¬çš„ã«ä½ä¸‹ã—ã¦ãŠã‚Šã€ç§»å‹•ãƒ»æ’æ³„ã¯ä¸€éƒ¨ä»‹åŠ©ã‚’è¦ã™ã‚‹ã€‚\n" +
    "åš¥ä¸‹æ©Ÿèƒ½ã®ä½ä¸‹ãŒã¿ã‚‰ã‚Œã‚‹ãŸã‚ã€é£Ÿäº‹å½¢æ…‹ã«ç•™æ„ã—ã¦ã„ã‚‹ã€‚";

  fact.value =
    "ãƒ»æ—¥ä¸­ã¯å±…å®¤å†…ã§éã”ã™æ™‚é–“ãŒå¤šã„ãŒã€å£°ã‹ã‘ã«ã‚ˆã‚Šé£Ÿå ‚ã¸ç§»å‹•ã§ãã‚‹å ´é¢ãŒã¿ã‚‰ã‚Œã‚‹\n" +
    "ãƒ»é£Ÿäº‹æ‘‚å–é‡ã¯æ—¥ã«ã‚ˆã£ã¦ã°ã‚‰ã¤ããŒã‚ã‚‹ãŒã€å…¨é‡æ‘‚å–ã§ãã‚‹æ—¥ã‚‚ã‚ã‚‹\n" +
    "ãƒ»å…¥æµ´æ™‚ã«ä¸å®‰ã‚’è¨´ãˆã‚‹å ´é¢ãŒã‚ã‚Šã€æ‹’å¦çš„ãªè¨€å‹•ãŒã¿ã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹";

  team.value =
    "ã€ä»‹è­·è·ã€‘\n" +
    "å¤œé–“å¸¯ã«è¦šé†’ã—ã€å±…å®¤å†…ã‚’æ­©ã“ã†ã¨ã™ã‚‹æ§˜å­ãŒã¿ã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚\n" +
    "å£°ã‹ã‘ã«ã‚ˆã‚Šè½ã¡ç€ãå ´é¢ã‚‚ã‚ã‚‹ã€‚\n\n" +
    "ã€çœ‹è­·è·ã€‘\n" +
    "ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³ã¯æ¦‚ã­å®‰å®šã—ã¦ã„ã‚‹ã€‚\n" +
    "æœè–¬çŠ¶æ³ã«å¤§ããªå•é¡Œã¯èªã‚ã‚‰ã‚Œã¦ã„ãªã„ã€‚\n\n" +
    "ã€ãƒªãƒè·ã€‘\n" +
    "ä¸‹è‚¢ç­‹åŠ›ã®ä½ä¸‹ãŒã¿ã‚‰ã‚Œã€ç«‹ã¡ä¸ŠãŒã‚Šæ™‚ã¯è¦‹å®ˆã‚ŠãŒå¿…è¦ã€‚\n" +
    "ç§»å‹•æ™‚ã¯è»¢å€’ãƒªã‚¹ã‚¯ã«ç•™æ„ãŒå¿…è¦ã¨è€ƒãˆã‚‰ã‚Œã‚‹ã€‚";

  goal.value =
    "æ–½è¨­å†…ã«ãŠã„ã¦å®‰å¿ƒã—ã¦ç”Ÿæ´»ã§ãã‚‹ç’°å¢ƒã‚’æ•´ãˆã€\n" +
    "å¿ƒèº«ã®çŠ¶æ…‹ã«é…æ…®ã—ãªãŒã‚‰å®‰å®šã—ãŸç”Ÿæ´»ã‚’ç¶™ç¶šã§ãã‚‹ã‚ˆã†æ”¯æ´ã™ã‚‹ã€‚";

  focus.value =
    "å¤œé–“ã®è¦šé†’çŠ¶æ³ã¨å®‰å…¨é¢ã¸ã®å½±éŸ¿ã€\n" +
    "å…¥æµ´æ™‚ã®ä¸å®‰ã‚„æ‹’å¦çš„åå¿œã¸ã®å¯¾å¿œæ–¹æ³•";
}

async function generate() {
  let remain = Number(localStorage.getItem("facility_remain"));
  if (remain <= 0) {
    alert("ç„¡æ–™ä½“é¨“ã¯çµ‚äº†ã—ã¾ã—ãŸã€‚");
    return;
  }

  const text = `
ã€æ–½è¨­ç¨®åˆ¥ã€‘${facilityType.value}
ã€åŸºæœ¬æƒ…å ±ã€‘${basic.value}
ã€ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°äº‹å®Ÿã€‘${fact.value}
ã€å¤šè·ç¨®æƒ…å ±ã€‘${team.value}
ã€ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ç›®æ¨™ã€‘${goal.value}
ã€ç¢ºèªãƒã‚¤ãƒ³ãƒˆã€‘${focus.value}
  `;

  startProgress();

  const res = await fetch("/api/generate-facility-eval", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text })
  });

  const data = await res.json();
  finishProgress();
  result.textContent = data.result;
  copyGuide.style.display = "block";

  localStorage.setItem("facility_remain", --remain);
  updateLimit();
}

/* ç®¡ç†è€…éš ã—ã‚³ãƒãƒ³ãƒ‰ */
document.addEventListener("keydown", e => {
  if (e.ctrlKey && e.shiftKey && e.key === "R") {
    if (prompt("ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰") === "admin123") {
      localStorage.setItem("facility_remain", 3);
      alert("å›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ");
      location.reload();
    }
  }
});
</script>

</body>
</html>
